% (********************************************)
% (** SYMORO+ : SYmbolic MOdelling of RObots **)
% (**========================================**)
% (**      IRCCyN-ECN - 1, rue de la Noe     **)
% (**      B.P.92101                         **)
% (**      44321 Nantes cedex 3, FRANCE      **)
% (**      www.irccyn.ec-nantes.fr           **)
% (********************************************)


%    Name of file : C:\Users\dell.dell-PC\Desktop\Symoro\Tatsuki\twoLink4DoF_ver13.ddm


%      Geometric parameters   

% j     ant   mu    sigma gamma b     alpha d     theta r
% 1     0     1     0     0     0     a1    0     t1    0
% 2     1     1     0     0     0     a2    0     t2    0
% 3     2     1     0     0     0     a3    0     t3    r3
% 4     3     1     0     0     0     a4    0     t4    0
% 5     4     0     2     0     0     a5    0     0     r5



%              Inertial parameters

% j     XX    XY    XZ    YY    YZ    ZZ    MX    MY    MZ    M     Ia

% 1     0     0     0     0     0     0     0     0     0     0     0

% 2     0     0     0     0     0     0     0     0     0     0     0

% 3     XX3   XY3   XZ3   YY3   YZ3   ZZ3   MX3   MY3   MZ3   M3    0

% 4     0     0     0     0     0     0     0     0     0     0     0

% 5     XX5   XY5   XZ5   YY5   YZ5   ZZ5   MX5   MY5   MZ5   M5    0



%  External forces,friction parameters, joint velocities and accelerations

% j      FX     FY     FZ     CX     CY     CZ     FS     FV     QP     QDP

% 1      0      0      0      0      0      0      0      0      QP1    QDP1

% 2      0      0      0      0      0      0      0      0      QP2    QDP2

% 3      0      0      0      0      0      0      0      0      QP3    QDP3

% 4      0      0      0      0      0      0      0      0      QP4    QDP4

% 5      0      0      0      0      0      0      0      0      0      0

% Base velocity, base accelerations, and gravity

% j     W0    WP0   V0    VP0   G

% 1     0     0     0     0     0

% 2     0     0     0     0     0

% 3     0     0     0     0     G3


%  Direct Calculation of the Joints Accelerations

% Equations:

% Declaration of the function
function accelerations = forwardDynamics4Dof(armModel, tau)

 % Forces to apply
 GAM1 = tau(1);
 GAM2 = tau(2);
 GAM3 = tau(3);
 GAM4 = tau(4);
    
 % Arm state
 state = armModel.getState();
    
 % Arm current state
 [t1, t2, t3, t4] = feval(@(x) x{:}, num2cell(state(1,:)));
 [QP1, QP2, QP3, QP4] = feval(@(x) x{:}, num2cell(state(2,:)));

 joint1 = armModel.joints(1);
 joint2 = armModel.joints(2);
 joint3 = armModel.joints(3);
 joint4 = armModel.joints(4);
 joint5 = armModel.joints(5);
 
 % Arm MDH parameters
 a1 = joint1.twist;
 a2 = joint2.twist;
 a3 = joint3.twist;
 a4 = joint4.twist;
 a5 = joint5.twist;
 r3 = joint3.offset;
 r5 = joint5.offset;
 
 % First moment of inertia
 [MX3, MY3, MZ3] = feval(@(x) x{:}, num2cell((joint3.com * joint3.mass)));
 [MX5, MY5 ,MZ5] = feval(@(x) x{:}, num2cell((joint5.com * joint5.mass)));
 M3 = joint3.mass;
 M5 = joint5.mass;
 
 % Second moment of inertia, i.e., inertia tensor
 tensor3 = joint3.inertiaTensor;
 tensor5 = joint5.inertiaTensor;
    
 XX3 = tensor3(1,1);
 XY3 = tensor3(1,2);
 XZ3 = tensor3(1,3);
 YY3 = tensor3(2,2);
 YZ3 = tensor3(2,3);
 ZZ3 = tensor3(3,3);
    
 XX5 = tensor5(1,1);
 XY5 = tensor5(1,2);
 XZ5 = tensor5(1,3);
 YY5 = tensor5(2,2);
 YZ5 = tensor5(2,3);
 ZZ5 = tensor5(3,3);
     
 % Gravity
 [~, ~, G3] = feval(@(x) x{:}, num2cell(armModel.gravity));
 
% Function description:

	S1=sin(t1);
	C1=cos(t1);
	Sa1=sin(a1);
	Ca1=cos(a1);
	S2=sin(t2);
	C2=cos(t2);
	Sa2=sin(a2);
	Ca2=cos(a2);
	S3=sin(t3);
	C3=cos(t3);
	Sa3=sin(a3);
	Ca3=cos(a3);
	S4=sin(t4);
	C4=cos(t4);
	Sa4=sin(a4);
	Ca4=cos(a4);
	Sa5=sin(a5);
	Ca5=cos(a5);
	A311=S1.*Sa1;
	A321=C1.*Sa1;
	A212=Ca2.*S2;
	A222=C2.*Ca2;
	A312=S2.*Sa2;
	A322=C2.*Sa2;
	WI12=A312.*QP1;
	WI22=A322.*QP1;
	WI32=Ca2.*QP1;
	W32=QP2 + WI32;
	A213=Ca3.*S3;
	A223=C3.*Ca3;
	A313=S3.*Sa3;
	A323=C3.*Sa3;
	LOO23=-(r3.*Sa3);
	LOO33=Ca3.*r3;
	WI13=A313.*W32 + C3.*WI12 + A213.*WI22;
	WI23=A323.*W32 - S3.*WI12 + A223.*WI22;
	WI33=Ca3.*W32 - Sa3.*WI22;
	W33=QP3 + WI33;
	JPR113=A313.*LOO23 - A213.*LOO33;
	JPR123=C3.*LOO33;
	JPR133=-(C3.*LOO23);
	JPR213=A323.*LOO23 - A223.*LOO33;
	JPR223=-(LOO33.*S3);
	JPR233=LOO23.*S3;
	JPR313=Ca3.*LOO23 + LOO33.*Sa3;
	A214=Ca4.*S4;
	A224=C4.*Ca4;
	A314=S4.*Sa4;
	A324=C4.*Sa4;
	WI14=A314.*W33 + C4.*WI13 + A214.*WI23;
	WI24=A324.*W33 - S4.*WI13 + A224.*WI23;
	WI34=Ca4.*W33 - Sa4.*WI23;
	W34=QP4 + WI34;
	LOO25=-(r5.*Sa5);
	LOO35=Ca5.*r5;
	WI25=Sa5.*W34 + Ca5.*WI24;
	WI35=Ca5.*W34 - Sa5.*WI24;
	JPR215=-(Ca5.*LOO35) + LOO25.*Sa5;
	JPR315=Ca5.*LOO25 + LOO35.*Sa5;
	WQ12=QP2.*WI22;
	WQ22=-(QP2.*WI12);
	JW13=WI13.*XX3 + WI23.*XY3 + W33.*XZ3;
	JW23=WI13.*XY3 + WI23.*YY3 + W33.*YZ3;
	JW33=WI13.*XZ3 + WI23.*YZ3 + W33.*ZZ3;
	KW13=-(JW23.*W33) + JW33.*WI23;
	KW23=JW13.*W33 - JW33.*WI13;
	KW33=JW23.*WI13 - JW13.*WI23;
	SW13=-(W33.*(MX3.*W33 - MZ3.*WI13)) + WI23.*(MY3.*WI13 - MX3.*WI23);
	SW23=-(WI13.*(MY3.*WI13 - MX3.*WI23)) + W33.*(-(MY3.*W33) + MZ3.*WI23);
	SW33=WI13.*(MX3.*W33 - MZ3.*WI13) - WI23.*(-(MY3.*W33) + MZ3.*WI23);
	WQ13=QP3.*WI23;
	WQ23=-(QP3.*WI13);
	LW13=C3.*(LOO33.*W32.*WI12 + LOO23.*WI12.*WI22) + A213.*(-(LOO23.*WI12.^2) + W32.*(-(LOO23.*W32) + LOO33.*WI22)) + A313.*(-(LOO33.*WI12.^2) - WI22.*(-(LOO23.*W32) + LOO33.*WI22));
	LW23=-(S3.*(LOO33.*W32.*WI12 + LOO23.*WI12.*WI22)) + A223.*(-(LOO23.*WI12.^2) + W32.*(-(LOO23.*W32) + LOO33.*WI22)) + A323.*(-(LOO33.*WI12.^2) - WI22.*(-(LOO23.*W32) + LOO33.*WI22));
	LW33=-(Sa3.*(-(LOO23.*WI12.^2) + W32.*(-(LOO23.*W32) + LOO33.*WI22))) + Ca3.*(-(LOO33.*WI12.^2) - WI22.*(-(LOO23.*W32) + LOO33.*WI22));
	WQ14=QP4.*WI24;
	WQ24=-(QP4.*WI14);
	JW15=WI14.*XX5 + WI25.*XY5 + WI35.*XZ5;
	JW25=WI14.*XY5 + WI25.*YY5 + WI35.*YZ5;
	JW35=WI14.*XZ5 + WI25.*YZ5 + WI35.*ZZ5;
	KW15=JW35.*WI25 - JW25.*WI35;
	KW25=-(JW35.*WI14) + JW15.*WI35;
	KW35=JW25.*WI14 - JW15.*WI25;
	SW15=WI25.*(MY5.*WI14 - MX5.*WI25) - WI35.*(-(MZ5.*WI14) + MX5.*WI35);
	SW25=-(WI14.*(MY5.*WI14 - MX5.*WI25)) + WI35.*(MZ5.*WI25 - MY5.*WI35);
	SW35=WI14.*(-(MZ5.*WI14) + MX5.*WI35) - WI25.*(MZ5.*WI25 - MY5.*WI35);
	LW15=LOO35.*W34.*WI14 + LOO25.*WI14.*WI24;
	LW25=Ca5.*(-(LOO25.*WI14.^2) + W34.*(-(LOO25.*W34) + LOO35.*WI24)) + Sa5.*(-(LOO35.*WI14.^2) - WI24.*(-(LOO25.*W34) + LOO35.*WI24));
	LW35=-(Sa5.*(-(LOO25.*WI14.^2) + W34.*(-(LOO25.*W34) + LOO35.*WI24))) + Ca5.*(-(LOO35.*WI14.^2) - WI24.*(-(LOO25.*W34) + LOO35.*WI24));
	NG15=LW35.*MY5 - LW25.*MZ5;
	NG25=-(LW35.*MX5) + LW15.*MZ5;
	NG35=LW25.*MX5 - LW15.*MY5;
	NG45=LW15.*M5;
	NG55=LW25.*M5;
	NG65=LW35.*M5;
	AP15=KW15 + NG15;
	AP25=KW25 + NG25;
	AP35=KW35 + NG35;
	AP45=NG45 + SW15;
	AP55=NG55 + SW25;
	AP65=NG65 + SW35;
	GX115=JPR315.*MY5 - JPR215.*MZ5 + XX5;
	GX155=JPR215.*M5 - MZ5;
	GX165=JPR315.*M5 + MY5;
	GX215=Ca5.*XY5 - Sa5.*XZ5;
	GX225=LOO35.*MZ5 + Ca5.*YY5 - Sa5.*YZ5;
	GX235=-(LOO35.*MY5) + Ca5.*YZ5 - Sa5.*ZZ5;
	GX245=LOO35.*M5 + Ca5.*MZ5 + MY5.*Sa5;
	GX255=-(MX5.*Sa5);
	GX265=-(Ca5.*MX5);
	GX315=Sa5.*XY5 + Ca5.*XZ5;
	GX325=-(LOO25.*MZ5) + Sa5.*YY5 + Ca5.*YZ5;
	GX335=LOO25.*MY5 + Sa5.*YZ5 + Ca5.*ZZ5;
	GX345=-(LOO25.*M5) - Ca5.*MY5 + MZ5.*Sa5;
	GX355=Ca5.*MX5;
	GX365=-(MX5.*Sa5);
	GX515=-(Ca5.*MZ5) - MY5.*Sa5;
	GX525=MX5.*Sa5;
	GX535=Ca5.*MX5;
	GX555=Ca5.*M5;
	GX565=-(M5.*Sa5);
	GX615=Ca5.*MY5 - MZ5.*Sa5;
	GX625=-(Ca5.*MX5);
	GX635=MX5.*Sa5;
	GX655=M5.*Sa5;
	GX665=Ca5.*M5;
	TKT115=GX115 + GX155.*JPR215 + GX165.*JPR315;
	TKT215=GX215 + GX255.*JPR215 + GX265.*JPR315;
	TKT315=GX315 + GX355.*JPR215 + GX365.*JPR315;
	TKT515=GX515 + GX555.*JPR215 + GX565.*JPR315;
	TKT615=GX615 + GX655.*JPR215 + GX665.*JPR315;
	TKT225=Ca5.*GX225 + GX245.*LOO35 - GX235.*Sa5;
	TKT325=Ca5.*GX325 + GX345.*LOO35 - GX335.*Sa5;
	TKT425=LOO35.*M5 + Ca5.*MZ5 + MY5.*Sa5;
	TKT525=Ca5.*GX525 - GX535.*Sa5;
	TKT625=Ca5.*GX625 - GX635.*Sa5;
	TKT335=Ca5.*GX335 - GX345.*LOO25 + GX325.*Sa5;
	TKT435=-(LOO25.*M5) - Ca5.*MY5 + MZ5.*Sa5;
	TKT535=Ca5.*GX535 + GX525.*Sa5;
	TKT635=Ca5.*GX635 + GX625.*Sa5;
	TKT555=Ca5.*GX555 - GX565.*Sa5;
	TKT655=Ca5.*GX655 - GX665.*Sa5;
	TKT665=Ca5.*GX665 + GX655.*Sa5;
	VBE14=-AP15 - AP55.*JPR215 - AP65.*JPR315;
	VBE24=-(AP25.*Ca5) - AP45.*LOO35 + AP35.*Sa5;
	VBE34=-(AP35.*Ca5) + AP45.*LOO25 - AP25.*Sa5;
	VBE54=-(AP55.*Ca5) + AP65.*Sa5;
	VBE64=-(AP65.*Ca5) - AP55.*Sa5;
	JD4=1./TKT335;
	JU14=JD4.*TKT315;
	JU24=JD4.*TKT325;
	JU34=JD4.*TKT335;
	JU44=JD4.*TKT435;
	JU54=JD4.*TKT535;
	JU64=JD4.*TKT635;
	GW4=GAM4 + VBE34;
	GK114=TKT115 - JU14.*TKT315;
	GK124=TKT215 - JU14.*TKT325;
	GK134=TKT315 - JU14.*TKT335;
	GK214=TKT215 - JU24.*TKT315;
	GK224=TKT225 - JU24.*TKT325;
	GK234=TKT325 - JU24.*TKT335;
	GK314=TKT315 - JU34.*TKT315;
	GK324=TKT325 - JU34.*TKT325;
	GK334=TKT335 - JU34.*TKT335;
	GK414=-(JU44.*TKT315);
	GK424=-(JU44.*TKT325) + TKT425;
	GK434=-(JU44.*TKT335) + TKT435;
	GK444=M5 - JU44.*TKT435;
	GK454=-(JU44.*TKT535);
	GK464=-(JU44.*TKT635);
	GK514=-(JU54.*TKT315) + TKT515;
	GK524=-(JU54.*TKT325) + TKT525;
	GK534=-(JU54.*TKT335) + TKT535;
	GK544=-(JU54.*TKT435);
	GK554=-(JU54.*TKT535) + TKT555;
	GK564=-(JU54.*TKT635) + TKT655;
	GK614=-(JU64.*TKT315) + TKT615;
	GK624=-(JU64.*TKT325) + TKT625;
	GK634=-(JU64.*TKT335) + TKT635;
	GK644=-(JU64.*TKT435);
	GK654=-(JU64.*TKT535) + TKT655;
	GK664=-(JU64.*TKT635) + TKT665;
	NG14=GK114.*WQ14 + GK124.*WQ24;
	NG24=GK214.*WQ14 + GK224.*WQ24;
	NG34=GK314.*WQ14 + GK324.*WQ24;
	NG44=GK414.*WQ14 + GK424.*WQ24;
	NG54=GK514.*WQ14 + GK524.*WQ24;
	NG64=GK614.*WQ14 + GK624.*WQ24;
	VS14=GW4.*JU14 + NG14;
	VS24=GW4.*JU24 + NG24;
	VS34=GW4.*JU34 + NG34;
	VS44=GW4.*JU44 + NG44;
	VS54=GW4.*JU54 + NG54;
	VS64=GW4.*JU64 + NG64;
	AP14=-VBE14 + VS14;
	AP24=-VBE24 + VS24;
	AP34=-VBE34 + VS34;
	AP44=AP45 + VS44;
	AP54=-VBE54 + VS54;
	AP64=-VBE64 + VS64;
	GX114=C4.*GK114 - GK214.*S4;
	GX124=C4.*GK124 - GK224.*S4;
	GX214=A214.*GK114 + A224.*GK214 - GK314.*Sa4;
	GX224=A214.*GK124 + A224.*GK224 - GK324.*Sa4;
	GX234=A214.*GK134 + A224.*GK234 - GK334.*Sa4;
	GX314=A314.*GK114 + A324.*GK214 + Ca4.*GK314;
	GX324=A314.*GK124 + A324.*GK224 + Ca4.*GK324;
	GX334=A314.*GK134 + A324.*GK234 + Ca4.*GK334;
	GX414=C4.*GK414 - GK514.*S4;
	GX424=C4.*GK424 - GK524.*S4;
	GX434=C4.*GK434 - GK534.*S4;
	GX444=C4.*GK444 - GK544.*S4;
	GX454=C4.*GK454 - GK554.*S4;
	GX514=A214.*GK414 + A224.*GK514 - GK614.*Sa4;
	GX524=A214.*GK424 + A224.*GK524 - GK624.*Sa4;
	GX534=A214.*GK434 + A224.*GK534 - GK634.*Sa4;
	GX544=A214.*GK444 + A224.*GK544 - GK644.*Sa4;
	GX554=A214.*GK454 + A224.*GK554 - GK654.*Sa4;
	GX564=A214.*GK464 + A224.*GK564 - GK664.*Sa4;
	GX614=A314.*GK414 + A324.*GK514 + Ca4.*GK614;
	GX624=A314.*GK424 + A324.*GK524 + Ca4.*GK624;
	GX634=A314.*GK434 + A324.*GK534 + Ca4.*GK634;
	GX644=A314.*GK444 + A324.*GK544 + Ca4.*GK644;
	GX654=A314.*GK454 + A324.*GK554 + Ca4.*GK654;
	GX664=A314.*GK464 + A324.*GK564 + Ca4.*GK664;
	TKT114=C4.*GX114 - GX124.*S4;
	TKT214=C4.*GX214 - GX224.*S4;
	TKT314=C4.*GX314 - GX324.*S4;
	TKT414=C4.*GX414 - GX424.*S4;
	TKT514=C4.*GX514 - GX524.*S4;
	TKT614=C4.*GX614 - GX624.*S4;
	TKT224=A214.*GX214 + A224.*GX224 - GX234.*Sa4;
	TKT324=A214.*GX314 + A224.*GX324 - GX334.*Sa4;
	TKT424=A214.*GX414 + A224.*GX424 - GX434.*Sa4;
	TKT524=A214.*GX514 + A224.*GX524 - GX534.*Sa4;
	TKT624=A214.*GX614 + A224.*GX624 - GX634.*Sa4;
	TKT334=A314.*GX314 + A324.*GX324 + Ca4.*GX334;
	TKT434=A314.*GX414 + A324.*GX424 + Ca4.*GX434;
	TKT534=A314.*GX514 + A324.*GX524 + Ca4.*GX534;
	TKT634=A314.*GX614 + A324.*GX624 + Ca4.*GX634;
	TKT444=C4.*GX444 - GX454.*S4;
	TKT544=C4.*GX544 - GX554.*S4;
	TKT644=C4.*GX644 - GX654.*S4;
	TKT554=A214.*GX544 + A224.*GX554 - GX564.*Sa4;
	TKT654=A214.*GX644 + A224.*GX654 - GX664.*Sa4;
	TKT664=A314.*GX644 + A324.*GX654 + Ca4.*GX664;
	MJE113=TKT114 + XX3;
	MJE213=TKT214 + XY3;
	MJE313=TKT314 + XZ3;
	MJE513=-MZ3 + TKT514;
	MJE613=MY3 + TKT614;
	MJE223=TKT224 + YY3;
	MJE323=TKT324 + YZ3;
	MJE423=MZ3 + TKT424;
	MJE623=-MX3 + TKT624;
	MJE333=TKT334 + ZZ3;
	MJE433=-MY3 + TKT434;
	MJE533=MX3 + TKT534;
	MJE443=M3 + TKT444;
	MJE553=M3 + TKT554;
	MJE663=M3 + TKT664;
	VBE13=-(AP14.*C4) - KW13 + AP24.*S4;
	VBE23=-(A214.*AP14) - A224.*AP24 - KW23 + AP34.*Sa4;
	VBE33=-(A314.*AP14) - A324.*AP24 - AP34.*Ca4 - KW33;
	VBE43=-(AP44.*C4) + AP54.*S4 - SW13;
	VBE53=-(A214.*AP44) - A224.*AP54 + AP64.*Sa4 - SW23;
	VBE63=-(A314.*AP44) - A324.*AP54 - AP64.*Ca4 - SW33;
	JD3=1./MJE333;
	JU13=JD3.*MJE313;
	JU23=JD3.*MJE323;
	JU33=JD3.*MJE333;
	JU43=JD3.*MJE433;
	JU53=JD3.*MJE533;
	JU63=JD3.*TKT634;
	GW3=GAM3 + VBE33;
	GK113=MJE113 - JU13.*MJE313;
	GK123=MJE213 - JU13.*MJE323;
	GK133=MJE313 - JU13.*MJE333;
	GK143=-(JU13.*MJE433) + TKT414;
	GK153=MJE513 - JU13.*MJE533;
	GK163=MJE613 - JU13.*TKT634;
	GK213=MJE213 - JU23.*MJE313;
	GK223=MJE223 - JU23.*MJE323;
	GK233=MJE323 - JU23.*MJE333;
	GK243=MJE423 - JU23.*MJE433;
	GK253=-(JU23.*MJE533) + TKT524;
	GK263=MJE623 - JU23.*TKT634;
	GK313=MJE313 - JU33.*MJE313;
	GK323=MJE323 - JU33.*MJE323;
	GK333=MJE333 - JU33.*MJE333;
	GK343=MJE433 - JU33.*MJE433;
	GK353=MJE533 - JU33.*MJE533;
	GK363=TKT634 - JU33.*TKT634;
	GK413=-(JU43.*MJE313) + TKT414;
	GK423=-(JU43.*MJE323) + MJE423;
	GK433=-(JU43.*MJE333) + MJE433;
	GK443=-(JU43.*MJE433) + MJE443;
	GK453=-(JU43.*MJE533) + TKT544;
	GK463=-(JU43.*TKT634) + TKT644;
	GK513=-(JU53.*MJE313) + MJE513;
	GK523=-(JU53.*MJE323) + TKT524;
	GK533=-(JU53.*MJE333) + MJE533;
	GK543=-(JU53.*MJE433) + TKT544;
	GK553=-(JU53.*MJE533) + MJE553;
	GK563=-(JU53.*TKT634) + TKT654;
	GK613=-(JU63.*MJE313) + MJE613;
	GK623=-(JU63.*MJE323) + MJE623;
	GK633=-(JU63.*MJE333) + TKT634;
	GK643=-(JU63.*MJE433) + TKT644;
	GK653=-(JU63.*MJE533) + TKT654;
	GK663=MJE663 - JU63.*TKT634;
	NG13=GK143.*LW13 + GK153.*LW23 + GK163.*LW33 + GK113.*WQ13 + GK123.*WQ23;
	NG23=GK243.*LW13 + GK253.*LW23 + GK263.*LW33 + GK213.*WQ13 + GK223.*WQ23;
	NG33=GK343.*LW13 + GK353.*LW23 + GK363.*LW33 + GK313.*WQ13 + GK323.*WQ23;
	NG43=GK443.*LW13 + GK453.*LW23 + GK463.*LW33 + GK413.*WQ13 + GK423.*WQ23;
	NG53=GK543.*LW13 + GK553.*LW23 + GK563.*LW33 + GK513.*WQ13 + GK523.*WQ23;
	NG63=GK643.*LW13 + GK653.*LW23 + GK663.*LW33 + GK613.*WQ13 + GK623.*WQ23;
	VS13=GW3.*JU13 + NG13;
	VS23=GW3.*JU23 + NG23;
	VS33=GW3.*JU33 + NG33;
	VS43=GW3.*JU43 + NG43;
	VS53=GW3.*JU53 + NG53;
	VS63=GW3.*JU63 + NG63;
	AP13=-VBE13 + VS13;
	AP23=-VBE23 + VS23;
	AP33=-VBE33 + VS33;
	AP43=-VBE43 + VS43;
	AP53=-VBE53 + VS53;
	AP63=-VBE63 + VS63;
	GX113=C3.*GK113 + GK413.*JPR113 + GK513.*JPR213 + GK613.*JPR313 - GK213.*S3;
	GX123=C3.*GK123 + GK423.*JPR113 + GK523.*JPR213 + GK623.*JPR313 - GK223.*S3;
	GX143=C3.*GK143 + GK443.*JPR113 + GK543.*JPR213 + GK643.*JPR313 - GK243.*S3;
	GX153=C3.*GK153 + GK453.*JPR113 + GK553.*JPR213 + GK653.*JPR313 - GK253.*S3;
	GX163=C3.*GK163 + GK463.*JPR113 + GK563.*JPR213 + GK663.*JPR313 - GK263.*S3;
	GX213=A213.*GK113 + A223.*GK213 + GK413.*JPR123 + GK513.*JPR223 - GK313.*Sa3;
	GX223=A213.*GK123 + A223.*GK223 + GK423.*JPR123 + GK523.*JPR223 - GK323.*Sa3;
	GX233=A213.*GK133 + A223.*GK233 + GK433.*JPR123 + GK533.*JPR223 - GK333.*Sa3;
	GX243=A213.*GK143 + A223.*GK243 + GK443.*JPR123 + GK543.*JPR223 - GK343.*Sa3;
	GX253=A213.*GK153 + A223.*GK253 + GK453.*JPR123 + GK553.*JPR223 - GK353.*Sa3;
	GX263=A213.*GK163 + A223.*GK263 + GK463.*JPR123 + GK563.*JPR223 - GK363.*Sa3;
	GX313=A313.*GK113 + A323.*GK213 + Ca3.*GK313 + GK413.*JPR133 + GK513.*JPR233;
	GX323=A313.*GK123 + A323.*GK223 + Ca3.*GK323 + GK423.*JPR133 + GK523.*JPR233;
	GX333=A313.*GK133 + A323.*GK233 + Ca3.*GK333 + GK433.*JPR133 + GK533.*JPR233;
	GX343=A313.*GK143 + A323.*GK243 + Ca3.*GK343 + GK443.*JPR133 + GK543.*JPR233;
	GX353=A313.*GK153 + A323.*GK253 + Ca3.*GK353 + GK453.*JPR133 + GK553.*JPR233;
	GX363=A313.*GK163 + A323.*GK263 + Ca3.*GK363 + GK463.*JPR133 + GK563.*JPR233;
	GX413=C3.*GK413 - GK513.*S3;
	GX423=C3.*GK423 - GK523.*S3;
	GX433=C3.*GK433 - GK533.*S3;
	GX443=C3.*GK443 - GK543.*S3;
	GX453=C3.*GK453 - GK553.*S3;
	GX463=C3.*GK463 - GK563.*S3;
	GX513=A213.*GK413 + A223.*GK513 - GK613.*Sa3;
	GX523=A213.*GK423 + A223.*GK523 - GK623.*Sa3;
	GX533=A213.*GK433 + A223.*GK533 - GK633.*Sa3;
	GX543=A213.*GK443 + A223.*GK543 - GK643.*Sa3;
	GX553=A213.*GK453 + A223.*GK553 - GK653.*Sa3;
	GX563=A213.*GK463 + A223.*GK563 - GK663.*Sa3;
	GX613=A313.*GK413 + A323.*GK513 + Ca3.*GK613;
	GX623=A313.*GK423 + A323.*GK523 + Ca3.*GK623;
	GX633=A313.*GK433 + A323.*GK533 + Ca3.*GK633;
	GX643=A313.*GK443 + A323.*GK543 + Ca3.*GK643;
	GX653=A313.*GK453 + A323.*GK553 + Ca3.*GK653;
	GX663=A313.*GK463 + A323.*GK563 + Ca3.*GK663;
	TKT113=C3.*GX113 + GX143.*JPR113 + GX153.*JPR213 + GX163.*JPR313 - GX123.*S3;
	TKT213=C3.*GX213 + GX243.*JPR113 + GX253.*JPR213 + GX263.*JPR313 - GX223.*S3;
	TKT313=C3.*GX313 + GX343.*JPR113 + GX353.*JPR213 + GX363.*JPR313 - GX323.*S3;
	TKT413=C3.*GX413 + GX443.*JPR113 + GX453.*JPR213 + GX463.*JPR313 - GX423.*S3;
	TKT513=C3.*GX513 + GX543.*JPR113 + GX553.*JPR213 + GX563.*JPR313 - GX523.*S3;
	TKT613=C3.*GX613 + GX643.*JPR113 + GX653.*JPR213 + GX663.*JPR313 - GX623.*S3;
	TKT223=A213.*GX213 + A223.*GX223 + GX243.*JPR123 + GX253.*JPR223 - GX233.*Sa3;
	TKT323=A213.*GX313 + A223.*GX323 + GX343.*JPR123 + GX353.*JPR223 - GX333.*Sa3;
	TKT423=A213.*GX413 + A223.*GX423 + GX443.*JPR123 + GX453.*JPR223 - GX433.*Sa3;
	TKT523=A213.*GX513 + A223.*GX523 + GX543.*JPR123 + GX553.*JPR223 - GX533.*Sa3;
	TKT623=A213.*GX613 + A223.*GX623 + GX643.*JPR123 + GX653.*JPR223 - GX633.*Sa3;
	TKT333=A313.*GX313 + A323.*GX323 + Ca3.*GX333 + GX343.*JPR133 + GX353.*JPR233;
	TKT433=A313.*GX413 + A323.*GX423 + Ca3.*GX433 + GX443.*JPR133 + GX453.*JPR233;
	TKT533=A313.*GX513 + A323.*GX523 + Ca3.*GX533 + GX543.*JPR133 + GX553.*JPR233;
	TKT633=A313.*GX613 + A323.*GX623 + Ca3.*GX633 + GX643.*JPR133 + GX653.*JPR233;
	VBE12=-(AP13.*C3) - AP43.*JPR113 - AP53.*JPR213 - AP63.*JPR313 + AP23.*S3;
	VBE22=-(A213.*AP13) - A223.*AP23 - AP43.*JPR123 - AP53.*JPR223 + AP33.*Sa3;
	VBE32=-(A313.*AP13) - A323.*AP23 - AP33.*Ca3 - AP43.*JPR133 - AP53.*JPR233;
	JD2=1./TKT333;
	JU12=JD2.*TKT313;
	JU22=JD2.*TKT323;
	JU32=JD2.*TKT333;
	JU42=JD2.*TKT433;
	JU52=JD2.*TKT533;
	JU62=JD2.*TKT633;
	GW2=GAM2 + VBE32;
	GK112=TKT113 - JU12.*TKT313;
	GK122=TKT213 - JU12.*TKT323;
	GK132=TKT313 - JU12.*TKT333;
	GK212=TKT213 - JU22.*TKT313;
	GK222=TKT223 - JU22.*TKT323;
	GK232=TKT323 - JU22.*TKT333;
	GK312=TKT313 - JU32.*TKT313;
	GK322=TKT323 - JU32.*TKT323;
	GK332=TKT333 - JU32.*TKT333;
	GK412=-(JU42.*TKT313) + TKT413;
	GK422=-(JU42.*TKT323) + TKT423;
	GK432=-(JU42.*TKT333) + TKT433;
	GK512=-(JU52.*TKT313) + TKT513;
	GK522=-(JU52.*TKT323) + TKT523;
	GK532=-(JU52.*TKT333) + TKT533;
	GK612=-(JU62.*TKT313) + TKT613;
	GK622=-(JU62.*TKT323) + TKT623;
	GK632=-(JU62.*TKT333) + TKT633;
	NG12=GK112.*WQ12 + GK122.*WQ22;
	NG22=GK212.*WQ12 + GK222.*WQ22;
	NG32=GK312.*WQ12 + GK322.*WQ22;
	VS12=GW2.*JU12 + NG12;
	VS22=GW2.*JU22 + NG22;
	VS32=GW2.*JU32 + NG32;
	AP12=-VBE12 + VS12;
	AP22=-VBE22 + VS22;
	AP32=-VBE32 + VS32;
	GX312=A312.*GK112 + A322.*GK212 + Ca2.*GK312;
	GX322=A312.*GK122 + A322.*GK222 + Ca2.*GK322;
	GX332=A312.*GK132 + A322.*GK232 + Ca2.*GK332;
	GX412=C2.*GK412 - GK512.*S2;
	GX422=C2.*GK422 - GK522.*S2;
	GX432=C2.*GK432 - GK532.*S2;
	GX512=A212.*GK412 + A222.*GK512 - GK612.*Sa2;
	GX522=A212.*GK422 + A222.*GK522 - GK622.*Sa2;
	GX532=A212.*GK432 + A222.*GK532 - GK632.*Sa2;
	GX612=A312.*GK412 + A322.*GK512 + Ca2.*GK612;
	GX622=A312.*GK422 + A322.*GK522 + Ca2.*GK622;
	GX632=A312.*GK432 + A322.*GK532 + Ca2.*GK632;
	TKT332=A312.*GX312 + A322.*GX322 + Ca2.*GX332;
	TKT432=A312.*GX412 + A322.*GX422 + Ca2.*GX432;
	TKT532=A312.*GX512 + A322.*GX522 + Ca2.*GX532;
	TKT632=A312.*GX612 + A322.*GX622 + Ca2.*GX632;
	VBE31=-(A312.*AP12) - A322.*AP22 - AP32.*Ca2;
	JD1=1./TKT332;
	JU41=JD1.*TKT432;
	JU51=JD1.*TKT532;
	JU61=JD1.*TKT632;
	GW1=GAM1 + VBE31;
	VR41=-(A311.*G3);
	VR51=-(A321.*G3);
	VR61=-(Ca1.*G3);
	GU1=JU41.*VR41 + JU51.*VR51 + JU61.*VR61;
	QDP1=-GU1 + GW1.*JD1;
	VR12=A312.*QDP1 + WQ12;
	VR22=A322.*QDP1 + WQ22;
	VR32=Ca2.*QDP1;
	VR42=C2.*VR41 + A212.*VR51 + A312.*VR61;
	VR52=-(S2.*VR41) + A222.*VR51 + A322.*VR61;
	VR62=-(Sa2.*VR51) + Ca2.*VR61;
	GU2=JU12.*VR12 + JU22.*VR22 + JU32.*VR32 + JU42.*VR42 + JU52.*VR52 + JU62.*VR62;
	QDP2=-GU2 + GW2.*JD2;
	WP32=QDP2 + VR32;
	VR13=C3.*VR12 + A213.*VR22 + A313.*WP32 + WQ13;
	VR23=-(S3.*VR12) + A223.*VR22 + A323.*WP32 + WQ23;
	VR33=-(Sa3.*VR22) + Ca3.*WP32;
	VR43=LW13 + JPR113.*VR12 + JPR123.*VR22 + C3.*VR42 + A213.*VR52 + A313.*VR62 + JPR133.*WP32;
	VR53=LW23 + JPR213.*VR12 + JPR223.*VR22 - S3.*VR42 + A223.*VR52 + A323.*VR62 + JPR233.*WP32;
	VR63=LW33 + JPR313.*VR12 - Sa3.*VR52 + Ca3.*VR62;
	GU3=JU13.*VR13 + JU23.*VR23 + JU33.*VR33 + JU43.*VR43 + JU53.*VR53 + JU63.*VR63;
	QDP3=-GU3 + GW3.*JD3;
	WP33=QDP3 + VR33;
	VR14=C4.*VR13 + A214.*VR23 + A314.*WP33 + WQ14;
	VR24=-(S4.*VR13) + A224.*VR23 + A324.*WP33 + WQ24;
	VR34=-(Sa4.*VR23) + Ca4.*WP33;
	VR44=C4.*VR43 + A214.*VR53 + A314.*VR63;
	VR54=-(S4.*VR43) + A224.*VR53 + A324.*VR63;
	VR64=-(Sa4.*VR53) + Ca4.*VR63;
	GU4=JU14.*VR14 + JU24.*VR24 + JU34.*VR34 + JU44.*VR44 + JU54.*VR54 + JU64.*VR64;
	QDP4=-GU4 + GW4.*JD4;

    accelerations(1) = QDP1;
    accelerations(2) = QDP2;
    accelerations(3) = QDP3;
    accelerations(4) = QDP4;
    

% *=*
% Number of operations : 665 '+' or '-', 959 '*' or '/'

